'use strict';

Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });

const extensionApi = require('@podman-desktop/api');

function _interopNamespaceDefault(e) {
  const n = Object.create(null, { [Symbol.toStringTag]: { value: 'Module' } });
  if (e) {
    for (const k in e) {
      if (k !== 'default') {
        const d = Object.getOwnPropertyDescriptor(e, k);
        Object.defineProperty(n, k, d.get ? d : {
          enumerable: true,
          get: () => e[k]
        });
      }
    }
  }
  n.default = e;
  return Object.freeze(n);
}

const extensionApi__namespace = /*#__PURE__*/_interopNamespaceDefault(extensionApi);

const SECOND = 1e9;
var path = require("path"), fs = require("fs");
function registerFromDir(startPath, filter, register) {
  if (!fs.existsSync(startPath)) {
    console.log("no dir ", startPath);
    return;
  }
  var files = fs.readdirSync(startPath);
  for (var i = 0; i < files.length; i++) {
    var filename = path.join(startPath, files[i]);
    var stat = fs.lstatSync(filename);
    if (stat.isDirectory()) {
      registerFromDir(filename, filter, register);
    } else if (filename.endsWith(filter)) {
      register(filename);
    }
  }
}
const AvailableModels = {};
let RAMALAMA_REMOTING_IMAGE = "quay.io/crcont/remoting:v0.10.0-remoting-0.2.1";
function reloadAvailableModels(extensionStoragePath) {
  Object.keys(AvailableModels).forEach((key) => delete AvailableModels[key]);
  console.log("go!");
  const registerModel = function(filename) {
    const dir_name = filename.split("/").at(-2);
    const name_parts = dir_name.split(".");
    const model_dir = name_parts.at(1);
    const model_name = name_parts.slice(2).join(".");
    const model_user_name = `${model_dir}/${model_name}`;
    AvailableModels[model_user_name] = filename;
    console.log(`found ${model_user_name}`);
  };
  registerFromDir(extensionStoragePath + "/../redhat.ai-lab/models", ".gguf", registerModel);
}
async function launchApirInferenceServer() {
  if (Object.keys(AvailableModels).length === 0) {
    await extensionApi__namespace.window.showErrorMessage("The list of models is empty. Please download models with Podman Desktop AI lab first.");
    return;
  }
  const model_name = "ibm-granite/granite-3.3-8b-instruct-GGUF";
  const imageInfo = await pullImage(
    RAMALAMA_REMOTING_IMAGE);
  const host_port = 1234;
  const model_src = AvailableModels[model_name];
  if (model_src === void 0) {
    throw new Error(`Couldn't get the file associated with model ${model_src}. This is unexpected.`);
  }
  const model_filename = path.basename(model_src);
  const model_dirname = path.basename(path.dirname(model_src));
  const model_dest = `/models/${model_filename}`;
  const labels = {
    ["ai-lab-inference-server"]: JSON.stringify([model_dirname]),
    ["api"]: `http://localhost:${host_port}/v1`,
    ["gpu"]: `llama.cpp API Remoting`,
    ["llama-cpp.apir"]: "true",
    ["trackingId"]: "idsfdf"
  };
  const mounts = [
    {
      Target: model_dest,
      Source: model_src,
      Type: "bind"
    }
  ];
  let entrypoint = void 0;
  let cmd = [];
  const envs = [`MODEL_PATH=${model_dest}`, "HOST=0.0.0.0", "PORT=8000", "GPU_LAYERS=999"];
  const devices = [];
  devices.push({
    PathOnHost: "/dev/dri",
    PathInContainer: "/dev/dri",
    CgroupPermissions: ""
  });
  const deviceRequests = [];
  deviceRequests.push({
    Capabilities: [["gpu"]],
    Count: -1
    // -1: all
  });
  const containerCreateOptions = {
    Image: imageInfo.Id,
    Detach: true,
    Entrypoint: entrypoint,
    Cmd: cmd,
    ExposedPorts: { [`${host_port}`]: {} },
    HostConfig: {
      AutoRemove: false,
      Devices: devices,
      Mounts: mounts,
      DeviceRequests: deviceRequests,
      SecurityOpt: ["label=disable"],
      PortBindings: {
        "8000/tcp": [
          {
            HostPort: `${host_port}`
          }
        ]
      }
    },
    HealthCheck: {
      // must be the port INSIDE the container not the exposed one
      Test: ["CMD-SHELL", `curl -sSf localhost:8000 > /dev/null`],
      Interval: SECOND * 5,
      Retries: 4 * 5
    },
    Labels: labels,
    Env: envs
  };
  console.log(containerCreateOptions, mounts);
  const { engineId, id } = await createContainer(imageInfo.engineId, containerCreateOptions);
}
async function createContainer(engineId, containerCreateOptions, labels) {
  console.log("Creating container ...");
  try {
    const result = await extensionApi.containerEngine.createContainer(engineId, containerCreateOptions);
    console.log("Container created!");
    return {
      id: result.id,
      engineId
    };
  } catch (err) {
    console.error(`Container creation failed :/ ${String(err)}`);
    throw err;
  }
}
async function pullImage(image, labels) {
  console.log(`Pulling the image ${image} ...`);
  const providers = extensionApi.provider.getContainerConnections();
  const podmanProvider = providers.filter(({ connection: connection2 }) => connection2.type === "podman");
  if (!podmanProvider) throw new Error(`cannot find podman provider`);
  let connection = podmanProvider[0].connection;
  return getImageInfo(connection, image).catch((err) => {
    console.error(`Something went wrong while pulling ${image}: ${String(err)}`);
    throw err;
  }).then((imageInfo) => {
    console.log("Image pulled successfully");
    return imageInfo;
  });
}
async function getImageInfo(connection, image, callback) {
  let imageInfo = void 0;
  try {
    imageInfo = (await extensionApi.containerEngine.listImages({
      provider: connection
    })).find((imageInfo2) => imageInfo2.RepoTags?.some((tag) => tag === image));
  } catch (err) {
    console.warn("Something went wrong while trying to get image inspect", err);
    await extensionApi__namespace.window.showErrorMessage(`Something went wrong while trying to get image inspect: ${err}`);
    throw err;
  }
  if (imageInfo === void 0) throw new Error(`image ${image} not found.`);
  return imageInfo;
}
async function activate(extensionContext) {
  if (!fs.existsSync(extensionContext.storagePath)) {
    fs.mkdirSync(extensionContext.storagePath);
  }
  console.error(`Loading the models ...`);
  reloadAvailableModels(extensionContext.storagePath);
  const menuCommand = extensionApi__namespace.commands.registerCommand("llama.cpp.apir.menu", async () => {
    if (!extensionApi__namespace.env.isMac && false) ;
    const CHOICES = [
      "Restart Podman Machine with API Remoting",
      "Restart Podman Machine with the default configuration",
      "Launch an API Remoting accelerated Inference Server"
    ];
    const result = CHOICES[2];
    try {
      if (result == CHOICES[0]) ; else if (result == CHOICES[1]) ; else if (result == CHOICES[2]) {
        await launchApirInferenceServer();
      }
    } catch (err) {
      console.error(`Task failed: ${String(err)}`);
      throw err;
    }
  });
  const item = extensionApi__namespace.window.createStatusBarItem(extensionApi__namespace.StatusBarAlignLeft, 100);
  item.text = "Llama.cpp API Remoting";
  item.command = "llama.cpp.apir.menu";
  item.show();
  extensionContext.subscriptions.push(menuCommand);
  extensionContext.subscriptions.push(item);
}
async function deactivate() {
}
async function restart_podman_machine(with_apir) {
  await extensionApi__namespace.window.showInformationMessage(`Restarting Podman machine ... (with APIR support: ${with_apir})`);
  try {
    const { stdout } = await extensionApi__namespace.process.exec("/usr/bin/echo", ["version"]);
    await extensionApi__namespace.window.showInformationMessage(`version: ${stdout}`);
    console.log(`version: ${stdout}`);
  } catch (error) {
    await extensionApi__namespace.window.showInformationMessage(`Error making binary executable: ${error}`);
    console.error(`Failed to execute command: ${error.message}`);
    throw new Error(`Error making binary executable: ${error}`);
  }
}

exports.SECOND = SECOND;
exports.activate = activate;
exports.deactivate = deactivate;
exports.restart_podman_machine = restart_podman_machine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaW9uLmpzIiwic291cmNlcyI6WyIuLi9zcmMvZXh0ZW5zaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtcbiAgICBDb250YWluZXJDcmVhdGVPcHRpb25zLFxuICAgIENvbnRhaW5lclByb3ZpZGVyQ29ubmVjdGlvbixcbiAgICBEZXZpY2VSZXF1ZXN0LFxuICAgIEltYWdlSW5mbyxcbiAgICBNb3VudENvbmZpZyxcbiAgICBQcm92aWRlckNvbnRhaW5lckNvbm5lY3Rpb24sXG59IGZyb20gJ0Bwb2RtYW4tZGVza3RvcC9hcGknO1xuXG5pbXBvcnQgKiBhcyBleHRlbnNpb25BcGkgZnJvbSAnQHBvZG1hbi1kZXNrdG9wL2FwaSc7XG5pbXBvcnQgdHlwZSB7IFBvZG1hbkNvbm5lY3Rpb24gfSBmcm9tICcuLi8uLi9tYW5hZ2Vycy9wb2RtYW5Db25uZWN0aW9uJztcbmltcG9ydCAqIGFzIFBvZG1hbkNvbm5lY3Rpb25BUEkgZnJvbSAnLi4vLi4vbWFuYWdlcnMvcG9kbWFuQ29ubmVjdGlvbic7XG5pbXBvcnQgeyBjb250YWluZXJFbmdpbmUsIHByb3ZpZGVyIH0gZnJvbSAnQHBvZG1hbi1kZXNrdG9wL2FwaSc7XG5cbmV4cG9ydCBjb25zdCBTRUNPTkQ6IG51bWJlciA9IDFfMDAwXzAwMF8wMDA7XG5cbnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpLFxuZnMgPSByZXF1aXJlKCdmcycpO1xuXG5mdW5jdGlvbiByZWdpc3RlckZyb21EaXIoc3RhcnRQYXRoLCBmaWx0ZXIsIHJlZ2lzdGVyKSB7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHN0YXJ0UGF0aCkpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJubyBkaXIgXCIsIHN0YXJ0UGF0aCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhzdGFydFBhdGgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGZpbGVuYW1lID0gcGF0aC5qb2luKHN0YXJ0UGF0aCwgZmlsZXNbaV0pO1xuICAgICAgICB2YXIgc3RhdCA9IGZzLmxzdGF0U3luYyhmaWxlbmFtZSk7XG4gICAgICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICAgIHJlZ2lzdGVyRnJvbURpcihmaWxlbmFtZSwgZmlsdGVyLCByZWdpc3Rlcik7IC8vcmVjdXJzZVxuICAgICAgICB9IGVsc2UgaWYgKGZpbGVuYW1lLmVuZHNXaXRoKGZpbHRlcikpIHtcbiAgICAgICAgICAgIHJlZ2lzdGVyKGZpbGVuYW1lKTtcbiAgICAgICAgfTtcbiAgICB9O1xufTtcblxuY29uc3QgQXZhaWxhYmxlTW9kZWxzID0ge307XG5sZXQgUkFNQUxBTUFfUkVNT1RJTkdfSU1BR0UgPSBcInF1YXkuaW8vY3Jjb250L3JlbW90aW5nOnYwLjEwLjAtcmVtb3RpbmctMC4yLjFcIjtcblxuZnVuY3Rpb24gcmVsb2FkQXZhaWxhYmxlTW9kZWxzKGV4dGVuc2lvblN0b3JhZ2VQYXRoKSB7XG4gICAgT2JqZWN0LmtleXMoQXZhaWxhYmxlTW9kZWxzKS5mb3JFYWNoKGtleSA9PiBkZWxldGUgQXZhaWxhYmxlTW9kZWxzW2tleV0pO1xuXG4gICAgY29uc29sZS5sb2coXCJnbyFcIik7XG4gICAgY29uc3QgcmVnaXN0ZXJNb2RlbCA9IGZ1bmN0aW9uKGZpbGVuYW1lKSB7XG4gICAgICAgIGNvbnN0IGRpcl9uYW1lID0gZmlsZW5hbWUuc3BsaXQoXCIvXCIpLmF0KC0yKVxuICAgICAgICBjb25zdCBuYW1lX3BhcnRzID0gZGlyX25hbWUuc3BsaXQoXCIuXCIpXG4gICAgICAgIC8vIDAgaXMgdGhlIHNvdXJjZSAoZWcsIGhmKVxuICAgICAgICBjb25zdCBtb2RlbF9kaXIgPSBuYW1lX3BhcnRzLmF0KDEpXG4gICAgICAgIGNvbnN0IG1vZGVsX25hbWUgPSBuYW1lX3BhcnRzLnNsaWNlKDIpLmpvaW4oJy4nKVxuICAgICAgICBjb25zdCBtb2RlbF91c2VyX25hbWUgPSBgJHttb2RlbF9kaXJ9LyR7bW9kZWxfbmFtZX1gXG4gICAgICAgIEF2YWlsYWJsZU1vZGVsc1ttb2RlbF91c2VyX25hbWVdID0gZmlsZW5hbWU7XG4gICAgICAgIGNvbnNvbGUubG9nKGBmb3VuZCAke21vZGVsX3VzZXJfbmFtZX1gKVxuICAgIH1cblxuICAgIHJlZ2lzdGVyRnJvbURpcihleHRlbnNpb25TdG9yYWdlUGF0aCArICcvLi4vcmVkaGF0LmFpLWxhYi9tb2RlbHMnLCAnLmdndWYnLCByZWdpc3Rlck1vZGVsKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbGF1bmNoQXBpckluZmVyZW5jZVNlcnZlcigpIHtcbiAgICBpZiAoT2JqZWN0LmtleXMoQXZhaWxhYmxlTW9kZWxzKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgYXdhaXQgZXh0ZW5zaW9uQXBpLndpbmRvdy5zaG93RXJyb3JNZXNzYWdlKFwiVGhlIGxpc3Qgb2YgbW9kZWxzIGlzIGVtcHR5LiBQbGVhc2UgZG93bmxvYWQgbW9kZWxzIHdpdGggUG9kbWFuIERlc2t0b3AgQUkgbGFiIGZpcnN0LlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZmFsc2UpIHtcbiAgICAgICAgLy8gZGlzcGxheSBhIGNob2ljZSB0byB0aGUgdXNlciBmb3Igc2VsZWN0aW5nIHNvbWUgdmFsdWVzXG4gICAgICAgIGNvbnN0IG1vZGVsX25hbWUgPSBhd2FpdCBleHRlbnNpb25BcGkud2luZG93LnNob3dRdWlja1BpY2soT2JqZWN0LmtleXMoQXZhaWxhYmxlTW9kZWxzKSwge1xuICAgICAgICAgICAgY2FuUGlja01hbnk6IGZhbHNlLCAvLyB1c2VyIGNhbiBzZWxlY3QgbW9yZSB0aGFuIG9uZSBjaG9pY2VcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChtb2RlbF9uYW1lID09PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcignTm8gbW9kZWwgY2hvc2VuLCBub3RoaW5nIHRvIGxhdW5jaC4nKTtcblxuICAgIH1cbiAgICBjb25zdCBtb2RlbF9uYW1lID0gXCJpYm0tZ3Jhbml0ZS9ncmFuaXRlLTMuMy04Yi1pbnN0cnVjdC1HR1VGXCI7XG4gICAgXG4gICAgLy8gcHVsbCB0aGUgaW1hZ2VcbiAgICBjb25zdCBpbWFnZUluZm86IEltYWdlSW5mbyA9IGF3YWl0IHB1bGxJbWFnZShcbiAgICAgICAgUkFNQUxBTUFfUkVNT1RJTkdfSU1BR0UsXG4gICAgICAgIHt9LFxuICAgICk7XG5cbiAgICAvLyBwcmVwYXJlIHRoZSBwb3J0XG4gICAgY29uc3QgaG9zdF9wb3J0ID0gMTIzNDtcbiAgICBcbiAgICAvLyBnZXQgbW9kZWwgbW91bnQgc2V0dGluZ3NcbiAgICBjb25zdCBtb2RlbF9zcmMgPSBBdmFpbGFibGVNb2RlbHNbbW9kZWxfbmFtZV07XG4gICAgaWYgKG1vZGVsX3NyYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGRuJ3QgZ2V0IHRoZSBmaWxlIGFzc29jaWF0ZWQgd2l0aCBtb2RlbCAke21vZGVsX3NyY30uIFRoaXMgaXMgdW5leHBlY3RlZC5gKTtcbiAgICB9XG4gICAgY29uc3QgbW9kZWxfZmlsZW5hbWUgPSBwYXRoLmJhc2VuYW1lKG1vZGVsX3NyYyk7XG4gICAgY29uc3QgbW9kZWxfZGlybmFtZSA9IHBhdGguYmFzZW5hbWUocGF0aC5kaXJuYW1lKG1vZGVsX3NyYykpO1xuICAgIGNvbnN0IG1vZGVsX2Rlc3QgPSBgL21vZGVscy8ke21vZGVsX2ZpbGVuYW1lfWA7XG5cbiAgICAvLyBwcmVwYXJlIHRoZSBsYWJlbHNcbiAgICBjb25zdCBsYWJlbHM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgICAgIFsnYWktbGFiLWluZmVyZW5jZS1zZXJ2ZXInXTogSlNPTi5zdHJpbmdpZnkoW21vZGVsX2Rpcm5hbWVdKSxcbiAgICAgICAgWydhcGknXTogYGh0dHA6Ly9sb2NhbGhvc3Q6JHtob3N0X3BvcnR9L3YxYCxcbiAgICAgICAgWydncHUnXTogYGxsYW1hLmNwcCBBUEkgUmVtb3RpbmdgLFxuICAgICAgICBbXCJsbGFtYS1jcHAuYXBpclwiXTogXCJ0cnVlXCIsXG4gICAgICAgIFtcInRyYWNraW5nSWRcIl06IFwiaWRzZmRmXCIsXG4gICAgfTtcbiAgICBcbiAgICAvLyBwcmVwYXJlIHRoZSBtb3VudHNcbiAgICAvLyBtb3VudCB0aGUgZmlsZSBkaXJlY3RvcnkgdG8gYXZvaWQgYWRkaW5nIG90aGVyIGZpbGVzIHRvIHRoZSBjb250YWluZXJzXG4gICAgY29uc3QgbW91bnRzOiBNb3VudENvbmZpZyA9IFtcbiAgICAgIHtcbiAgICAgICAgICBUYXJnZXQ6IG1vZGVsX2Rlc3QsXG4gICAgICAgICAgU291cmNlOiBtb2RlbF9zcmMsXG4gICAgICAgICAgVHlwZTogJ2JpbmQnLFxuICAgICAgfSxcbiAgICBdO1xuXG4gICAgLy8gcHJlcGFyZSB0aGUgZW50cnlwb2ludFxuICAgIGxldCBlbnRyeXBvaW50OiBzdHJpbmcgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gICAgbGV0IGNtZDogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIHByZXBhcmUgdGhlIGVudlxuICAgIGNvbnN0IGVudnM6IHN0cmluZ1tdID0gW2BNT0RFTF9QQVRIPSR7bW9kZWxfZGVzdH1gLCAnSE9TVD0wLjAuMC4wJywgJ1BPUlQ9ODAwMCcsICdHUFVfTEFZRVJTPTk5OSddO1xuXG4gICAgLy8gcHJlcGFyZSB0aGUgZGV2aWNlc1xuICAgIGNvbnN0IGRldmljZXM6IERldmljZVtdID0gW107XG4gICAgZGV2aWNlcy5wdXNoKHtcbiAgICAgICAgUGF0aE9uSG9zdDogJy9kZXYvZHJpJyxcbiAgICAgICAgUGF0aEluQ29udGFpbmVyOiAnL2Rldi9kcmknLFxuICAgICAgICBDZ3JvdXBQZXJtaXNzaW9uczogJycsXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgZGV2aWNlUmVxdWVzdHM6IERldmljZVJlcXVlc3RbXSA9IFtdO1xuICAgIGRldmljZVJlcXVlc3RzLnB1c2goe1xuICAgICAgICBDYXBhYmlsaXRpZXM6IFtbJ2dwdSddXSxcbiAgICAgICAgQ291bnQ6IC0xLCAvLyAtMTogYWxsXG4gICAgfSk7XG4gICAgXG4gICAgLy8gR2V0IHRoZSBjb250YWluZXIgY3JlYXRpb24gb3B0aW9uc1xuICAgIGNvbnN0IGNvbnRhaW5lckNyZWF0ZU9wdGlvbnM6IENvbnRhaW5lckNyZWF0ZU9wdGlvbnMgPSB7XG4gICAgICAgIEltYWdlOiBpbWFnZUluZm8uSWQsXG4gICAgICAgIERldGFjaDogdHJ1ZSxcbiAgICAgICAgRW50cnlwb2ludDogZW50cnlwb2ludCxcbiAgICAgICAgQ21kOiBjbWQsXG4gICAgICAgIEV4cG9zZWRQb3J0czogeyBbYCR7aG9zdF9wb3J0fWBdOiB7fSB9LFxuICAgICAgICBIb3N0Q29uZmlnOiB7XG4gICAgICAgICAgICBBdXRvUmVtb3ZlOiBmYWxzZSxcbiAgICAgICAgICAgIERldmljZXM6IGRldmljZXMsXG4gICAgICAgICAgICBNb3VudHM6IG1vdW50cyxcbiAgICAgICAgICAgIERldmljZVJlcXVlc3RzOiBkZXZpY2VSZXF1ZXN0cyxcbiAgICAgICAgICAgIFNlY3VyaXR5T3B0OiBbXCJsYWJlbD1kaXNhYmxlXCJdLFxuICAgICAgICAgICAgUG9ydEJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgJzgwMDAvdGNwJzogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBIb3N0UG9ydDogYCR7aG9zdF9wb3J0fWAsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBIZWFsdGhDaGVjazoge1xuICAgICAgICAgIC8vIG11c3QgYmUgdGhlIHBvcnQgSU5TSURFIHRoZSBjb250YWluZXIgbm90IHRoZSBleHBvc2VkIG9uZVxuICAgICAgICAgIFRlc3Q6IFsnQ01ELVNIRUxMJywgYGN1cmwgLXNTZiBsb2NhbGhvc3Q6ODAwMCA+IC9kZXYvbnVsbGBdLFxuICAgICAgICAgIEludGVydmFsOiBTRUNPTkQgKiA1LFxuICAgICAgICAgIFJldHJpZXM6IDQgKiA1LFxuICAgICAgICAgIH0sXG4gICAgICAgIExhYmVsczogbGFiZWxzLFxuICAgICAgICBFbnY6IGVudnMsXG4gICAgfTtcbiAgICBjb25zb2xlLmxvZyhjb250YWluZXJDcmVhdGVPcHRpb25zLCBtb3VudHMpXG4gICAgLy8gQ3JlYXRlIHRoZSBjb250YWluZXJcbiAgICBjb25zdCB7IGVuZ2luZUlkLCBpZCB9ID0gYXdhaXQgY3JlYXRlQ29udGFpbmVyKGltYWdlSW5mby5lbmdpbmVJZCwgY29udGFpbmVyQ3JlYXRlT3B0aW9ucywgbGFiZWxzKTtcblxuICAgIC8vYXdhaXQgZXh0ZW5zaW9uQXBpLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlKGBDb250YWluZXIgaGFzIGJlZW4gbGF1bmNoZWQhICR7ZW5naW5lSWR9IHwgJHtpZH1gKTtcblxufVxuZXhwb3J0IHR5cGUgQmV0dGVyQ29udGFpbmVyQ3JlYXRlUmVzdWx0ID0gQ29udGFpbmVyQ3JlYXRlUmVzdWx0ICYgeyBlbmdpbmVJZDogc3RyaW5nIH07XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lcihcbiAgICBlbmdpbmVJZDogc3RyaW5nLFxuICAgIGNvbnRhaW5lckNyZWF0ZU9wdGlvbnM6IENvbnRhaW5lckNyZWF0ZU9wdGlvbnMsXG4gICAgbGFiZWxzOiB7IFtpZDogc3RyaW5nXTogc3RyaW5nIH0sXG4pOiBQcm9taXNlPEJldHRlckNvbnRhaW5lckNyZWF0ZVJlc3VsdD4ge1xuXG4gICAgY29uc29sZS5sb2coXCJDcmVhdGluZyBjb250YWluZXIgLi4uXCIpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhaW5lckVuZ2luZS5jcmVhdGVDb250YWluZXIoZW5naW5lSWQsIGNvbnRhaW5lckNyZWF0ZU9wdGlvbnMpO1xuICAgICAgICAvLyB1cGRhdGUgdGhlIHRhc2tcbiAgICAgICAgY29uc29sZS5sb2coXCJDb250YWluZXIgY3JlYXRlZCFcIik7XG4gICAgICAgIFxuICAgICAgICAvLyByZXR1cm4gdGhlIENvbnRhaW5lckNyZWF0ZVJlc3VsdFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IHJlc3VsdC5pZCxcbiAgICAgICAgICAgIGVuZ2luZUlkOiBlbmdpbmVJZCxcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnI6IHVua25vd24pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgQ29udGFpbmVyIGNyZWF0aW9uIGZhaWxlZCA6LyAke1N0cmluZyhlcnIpfWApO1xuXG4gICAgICAgIHRocm93IGVycjtcbiAgICB9XG59IFxuXG5hc3luYyBmdW5jdGlvbiBwdWxsSW1hZ2UoXG4gICAgaW1hZ2U6IHN0cmluZyxcbiAgICBsYWJlbHM6IHsgW2lkOiBzdHJpbmddOiBzdHJpbmcgfSxcbik6IFByb21pc2U8SW1hZ2VJbmZvPiB7XG4gICAgLy8gQ3JlYXRpbmcgYSB0YXNrIHRvIGZvbGxvdyBwdWxsaW5nIHByb2dyZXNzXG4gICAgY29uc29sZS5sb2coYFB1bGxpbmcgdGhlIGltYWdlICR7aW1hZ2V9IC4uLmApXG5cbiAgICBjb25zdCBwcm92aWRlcnM6IFByb3ZpZGVyQ29udGFpbmVyQ29ubmVjdGlvbltdID0gcHJvdmlkZXIuZ2V0Q29udGFpbmVyQ29ubmVjdGlvbnMoKTtcbiAgICBjb25zdCBwb2RtYW5Qcm92aWRlciA9IHByb3ZpZGVyc1xuICAgICAgICAgIC5maWx0ZXIoKHsgY29ubmVjdGlvbiB9KSA9PiBjb25uZWN0aW9uLnR5cGUgPT09ICdwb2RtYW4nKTtcbiAgICBpZiAoIXBvZG1hblByb3ZpZGVyKSB0aHJvdyBuZXcgRXJyb3IoYGNhbm5vdCBmaW5kIHBvZG1hbiBwcm92aWRlcmApO1xuXG4gICAgbGV0IGNvbm5lY3Rpb246IENvbnRhaW5lclByb3ZpZGVyQ29ubmVjdGlvbiA9IHBvZG1hblByb3ZpZGVyWzBdLmNvbm5lY3Rpb247XG4gICAgXG4gICAgLy8gZ2V0IHRoZSBkZWZhdWx0IGltYWdlIGluZm8gZm9yIHRoaXMgcHJvdmlkZXJcbiAgICByZXR1cm4gZ2V0SW1hZ2VJbmZvKGNvbm5lY3Rpb24sIGltYWdlLCAoX2V2ZW50OiBQdWxsRXZlbnQpID0+IHt9KVxuICAgICAgICAuY2F0Y2goKGVycjogdW5rbm93bikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hpbGUgcHVsbGluZyAke2ltYWdlfTogJHtTdHJpbmcoZXJyKX1gKTtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oaW1hZ2VJbmZvID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSW1hZ2UgcHVsbGVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgICAgICAgIHJldHVybiBpbWFnZUluZm87XG4gICAgICAgIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRJbWFnZUluZm8oXG4gIGNvbm5lY3Rpb246IENvbnRhaW5lclByb3ZpZGVyQ29ubmVjdGlvbixcbiAgaW1hZ2U6IHN0cmluZyxcbiAgY2FsbGJhY2s6IChldmVudDogUHVsbEV2ZW50KSA9PiB2b2lkLFxuKTogUHJvbWlzZTxJbWFnZUluZm8+IHtcbiAgICBsZXQgaW1hZ2VJbmZvID0gdW5kZWZpbmVkO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAgIC8vIFB1bGwgaW1hZ2VcbiAgICAgICAgLy9hd2FpdCBjb250YWluZXJFbmdpbmUucHVsbEltYWdlKGNvbm5lY3Rpb24sIGltYWdlLCBjYWxsYmFjayk7XG5cbiAgICAgICAgLy8gR2V0IGltYWdlIGluc3BlY3RcbiAgICAgICAgaW1hZ2VJbmZvID0gKFxuICAgICAgICAgICAgYXdhaXQgY29udGFpbmVyRW5naW5lLmxpc3RJbWFnZXMoe1xuICAgICAgICAgICAgICAgIHByb3ZpZGVyOiBjb25uZWN0aW9uLFxuICAgICAgICAgICAgfSBhcyBMaXN0SW1hZ2VzT3B0aW9ucylcbiAgICAgICAgKS5maW5kKGltYWdlSW5mbyA9PiBpbWFnZUluZm8uUmVwb1RhZ3M/LnNvbWUodGFnID0+IHRhZyA9PT0gaW1hZ2UpKTtcblxuICAgIH0gY2F0Y2ggKGVycjogdW5rbm93bikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1NvbWV0aGluZyB3ZW50IHdyb25nIHdoaWxlIHRyeWluZyB0byBnZXQgaW1hZ2UgaW5zcGVjdCcsIGVycik7XG4gICAgICAgIGF3YWl0IGV4dGVuc2lvbkFwaS53aW5kb3cuc2hvd0Vycm9yTWVzc2FnZShgU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hpbGUgdHJ5aW5nIHRvIGdldCBpbWFnZSBpbnNwZWN0OiAke2Vycn1gKTtcblxuICAgICAgICB0aHJvdyBlcnI7XG4gICAgfVxuXG4gICAgaWYgKGltYWdlSW5mbyA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoYGltYWdlICR7aW1hZ2V9IG5vdCBmb3VuZC5gKTtcbiAgICBcbiAgICByZXR1cm4gaW1hZ2VJbmZvO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWN0aXZhdGUoZXh0ZW5zaW9uQ29udGV4dDogZXh0ZW5zaW9uQXBpLkV4dGVuc2lvbkNvbnRleHQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoZmFsc2UpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCBsb2NhbE1vZGVsczogTW9kZWxJbmZvW10gPSBtb2RlbHNJbmZvLmZpbHRlcihtb2RlbCA9PiBtb2RlbC5maWxlICYmIG1vZGVsLmJhY2tlbmQgIT09ICdub25lJyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbGlzdCBtb2RlbHM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGV4dGVuc2lvbkNvbnRleHQuc3RvcmFnZVBhdGgpKXtcbiAgICAgICAgZnMubWtkaXJTeW5jKGV4dGVuc2lvbkNvbnRleHQuc3RvcmFnZVBhdGgpO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmVycm9yKGBMb2FkaW5nIHRoZSBtb2RlbHMgLi4uYCk7XG4gICAgcmVsb2FkQXZhaWxhYmxlTW9kZWxzKGV4dGVuc2lvbkNvbnRleHQuc3RvcmFnZVBhdGgpO1xuXG4gICAgLy8gcmVnaXN0ZXIgdGhlIGNvbW1hbmQgcmVmZXJlbmNlZCBpbiBwYWNrYWdlLmpzb24gZmlsZVxuICAgIGNvbnN0IG1lbnVDb21tYW5kID0gZXh0ZW5zaW9uQXBpLmNvbW1hbmRzLnJlZ2lzdGVyQ29tbWFuZCgnbGxhbWEuY3BwLmFwaXIubWVudScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKCFleHRlbnNpb25BcGkuZW52LmlzTWFjICYmIGZhbHNlKSB7XG4gICAgICAgICAgICBhd2FpdCBleHRlbnNpb25BcGkud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoYEVSUk9SOiBsbGFtYS5jcHAgQVBJIFJlbW90aW5nIGN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBvbiBNYWNPUy5gKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBDSE9JQ0VTID0gW1xuICAgICAgICAgICAgJ1Jlc3RhcnQgUG9kbWFuIE1hY2hpbmUgd2l0aCBBUEkgUmVtb3RpbmcnLCBcbiAgICAgICAgICAgICdSZXN0YXJ0IFBvZG1hbiBNYWNoaW5lIHdpdGggdGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbicsIFxuICAgICAgICAgICAgJ0xhdW5jaCBhbiBBUEkgUmVtb3RpbmcgYWNjZWxlcmF0ZWQgSW5mZXJlbmNlIFNlcnZlciddO1xuICAgICAgICBpZiAoZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIGRpc3BsYXkgYSBjaG9pY2UgdG8gdGhlIHVzZXIgZm9yIHNlbGVjdGluZyBzb21lIHZhbHVlc1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0ZW5zaW9uQXBpLndpbmRvdy5zaG93UXVpY2tQaWNrKENIT0lDRVMsIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJXaGF0IGRvIHlvdSB3YW50IHRvIGRvP1wiLFxuICAgICAgICAgICAgICAgIGNhblBpY2tNYW55OiBmYWxzZSwgLy8gdXNlciBjYW4gc2VsZWN0IG1vcmUgdGhhbiBvbmUgY2hvaWNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXN1bHQgPSBDSE9JQ0VTWzJdO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0ID09IENIT0lDRVNbMF0pIHtcbiAgICAgICAgICAgICAgICBhd2FpdCByZXN0YXJ0X3BvZG1hbl9tYWNoaW5lKHRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgPT0gQ0hPSUNFU1sxXSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHJlc3RhcnRfcG9kbWFuX21hY2hpbmUoZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgPT0gQ0hPSUNFU1syXSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGxhdW5jaEFwaXJJbmZlcmVuY2VTZXJ2ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyOiB1bmtub3duKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBUYXNrIGZhaWxlZDogJHtTdHJpbmcoZXJyKX1gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBjcmVhdGUgYW4gaXRlbSBpbiB0aGUgc3RhdHVzIGJhciB0byBydW4gb3VyIGNvbW1hbmRcbiAgICAvLyBpdCB3aWxsIHN0aWNrIG9uIHRoZSBsZWZ0IG9mIHRoZSBzdGF0dXMgYmFyXG4gICAgY29uc3QgaXRlbSA9IGV4dGVuc2lvbkFwaS53aW5kb3cuY3JlYXRlU3RhdHVzQmFySXRlbShleHRlbnNpb25BcGkuU3RhdHVzQmFyQWxpZ25MZWZ0LCAxMDApO1xuICAgIGl0ZW0udGV4dCA9ICdMbGFtYS5jcHAgQVBJIFJlbW90aW5nJztcbiAgICBpdGVtLmNvbW1hbmQgPSAnbGxhbWEuY3BwLmFwaXIubWVudSc7XG4gICAgaXRlbS5zaG93KCk7XG5cbiAgICAvLyByZWdpc3RlciBkaXNwb3NhYmxlIHJlc291cmNlcyB0byBpdCdzIHJlbW92ZWQgd2hlbiB5b3UgZGVhY3RpdnRlIHRoZSBleHRlbnNpb25cbiAgICBleHRlbnNpb25Db250ZXh0LnN1YnNjcmlwdGlvbnMucHVzaChtZW51Q29tbWFuZCk7XG4gICAgZXh0ZW5zaW9uQ29udGV4dC5zdWJzY3JpcHRpb25zLnB1c2goaXRlbSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWFjdGl2YXRlKCk6IFByb21pc2U8dm9pZD4ge1xuXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXN0YXJ0X3BvZG1hbl9tYWNoaW5lKHdpdGhfYXBpcjogYm9vbGVhbik6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IGV4dGVuc2lvbkFwaS53aW5kb3cuc2hvd0luZm9ybWF0aW9uTWVzc2FnZShgUmVzdGFydGluZyBQb2RtYW4gbWFjaGluZSAuLi4gKHdpdGggQVBJUiBzdXBwb3J0OiAke3dpdGhfYXBpcn0pYCk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHN0ZG91dCB9ID0gYXdhaXQgZXh0ZW5zaW9uQXBpLnByb2Nlc3MuZXhlYyhcIi91c3IvYmluL2VjaG9cIiwgWyd2ZXJzaW9uJ10pO1xuICAgICAgICBhd2FpdCBleHRlbnNpb25BcGkud2luZG93LnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoYHZlcnNpb246ICR7c3Rkb3V0fWApO1xuICAgICAgICBjb25zb2xlLmxvZyhgdmVyc2lvbjogJHtzdGRvdXR9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgYXdhaXQgZXh0ZW5zaW9uQXBpLndpbmRvdy5zaG93SW5mb3JtYXRpb25NZXNzYWdlKGBFcnJvciBtYWtpbmcgYmluYXJ5IGV4ZWN1dGFibGU6ICR7ZXJyb3J9YCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBleGVjdXRlIGNvbW1hbmQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBtYWtpbmcgYmluYXJ5IGV4ZWN1dGFibGU6ICR7ZXJyb3J9YCk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImV4dGVuc2lvbkFwaSIsImNvbnRhaW5lckVuZ2luZSIsInByb3ZpZGVyIiwiY29ubmVjdGlvbiIsImltYWdlSW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWNPLE1BQU0sTUFBQSxHQUFpQjtBQUU5QixJQUFJLE9BQU8sT0FBQSxDQUFRLE1BQU0sQ0FBQSxFQUN6QixFQUFBLEdBQUssUUFBUSxJQUFJLENBQUE7QUFFakIsU0FBUyxlQUFBLENBQWdCLFNBQUEsRUFBVyxNQUFBLEVBQVEsUUFBQSxFQUFVO0FBQ2xELEVBQUEsSUFBSSxDQUFDLEVBQUEsQ0FBRyxVQUFBLENBQVcsU0FBUyxDQUFBLEVBQUc7QUFDM0IsSUFBQSxPQUFBLENBQVEsR0FBQSxDQUFJLFdBQVcsU0FBUyxDQUFBO0FBQ2hDLElBQUE7QUFBQSxFQUNKO0FBRUEsRUFBQSxJQUFJLEtBQUEsR0FBUSxFQUFBLENBQUcsV0FBQSxDQUFZLFNBQVMsQ0FBQTtBQUNwQyxFQUFBLEtBQUEsSUFBUyxDQUFBLEdBQUksQ0FBQSxFQUFHLENBQUEsR0FBSSxLQUFBLENBQU0sUUFBUSxDQUFBLEVBQUEsRUFBSztBQUNuQyxJQUFBLElBQUksV0FBVyxJQUFBLENBQUssSUFBQSxDQUFLLFNBQUEsRUFBVyxLQUFBLENBQU0sQ0FBQyxDQUFDLENBQUE7QUFDNUMsSUFBQSxJQUFJLElBQUEsR0FBTyxFQUFBLENBQUcsU0FBQSxDQUFVLFFBQVEsQ0FBQTtBQUNoQyxJQUFBLElBQUksSUFBQSxDQUFLLGFBQVksRUFBRztBQUNwQixNQUFBLGVBQUEsQ0FBZ0IsUUFBQSxFQUFVLFFBQVEsUUFBUSxDQUFBO0FBQUEsSUFDOUMsQ0FBQSxNQUFBLElBQVcsUUFBQSxDQUFTLFFBQUEsQ0FBUyxNQUFNLENBQUEsRUFBRztBQUNsQyxNQUFBLFFBQUEsQ0FBUyxRQUFRLENBQUE7QUFBQSxJQUNyQjtBQUFDLEVBQ0w7QUFDSjtBQUVBLE1BQU0sa0JBQWtCLEVBQUM7QUFDekIsSUFBSSx1QkFBQSxHQUEwQixnREFBQTtBQUU5QixTQUFTLHNCQUFzQixvQkFBQSxFQUFzQjtBQUNqRCxFQUFBLE1BQUEsQ0FBTyxJQUFBLENBQUssZUFBZSxDQUFBLENBQUUsT0FBQSxDQUFRLFNBQU8sT0FBTyxlQUFBLENBQWdCLEdBQUcsQ0FBQyxDQUFBO0FBRXZFLEVBQUEsT0FBQSxDQUFRLElBQUksS0FBSyxDQUFBO0FBQ2pCLEVBQUEsTUFBTSxhQUFBLEdBQWdCLFNBQVMsUUFBQSxFQUFVO0FBQ3JDLElBQUEsTUFBTSxXQUFXLFFBQUEsQ0FBUyxLQUFBLENBQU0sR0FBRyxDQUFBLENBQUUsR0FBRyxFQUFFLENBQUE7QUFDMUMsSUFBQSxNQUFNLFVBQUEsR0FBYSxRQUFBLENBQVMsS0FBQSxDQUFNLEdBQUcsQ0FBQTtBQUVyQyxJQUFBLE1BQU0sU0FBQSxHQUFZLFVBQUEsQ0FBVyxFQUFBLENBQUcsQ0FBQyxDQUFBO0FBQ2pDLElBQUEsTUFBTSxhQUFhLFVBQUEsQ0FBVyxLQUFBLENBQU0sQ0FBQyxDQUFBLENBQUUsS0FBSyxHQUFHLENBQUE7QUFDL0MsSUFBQSxNQUFNLGVBQUEsR0FBa0IsQ0FBQSxFQUFHLFNBQVMsQ0FBQSxDQUFBLEVBQUksVUFBVSxDQUFBLENBQUE7QUFDbEQsSUFBQSxlQUFBLENBQWdCLGVBQWUsQ0FBQSxHQUFJLFFBQUE7QUFDbkMsSUFBQSxPQUFBLENBQVEsR0FBQSxDQUFJLENBQUEsTUFBQSxFQUFTLGVBQWUsQ0FBQSxDQUFFLENBQUE7QUFBQSxFQUMxQyxDQUFBO0FBRUEsRUFBQSxlQUFBLENBQWdCLG9CQUFBLEdBQXVCLDBCQUFBLEVBQTRCLE9BQUEsRUFBUyxhQUFhLENBQUE7QUFDN0Y7QUFFQSxlQUFlLHlCQUFBLEdBQTRCO0FBQ3ZDLEVBQUEsSUFBSSxNQUFBLENBQU8sSUFBQSxDQUFLLGVBQWUsQ0FBQSxDQUFFLFdBQVcsQ0FBQSxFQUFHO0FBQzNDLElBQUEsTUFBTUEsdUJBQUEsQ0FBYSxNQUFBLENBQU8sZ0JBQUEsQ0FBaUIsdUZBQXVGLENBQUE7QUFDbEksSUFBQTtBQUFBLEVBQ0o7QUFTQSxFQUFBLE1BQU0sVUFBQSxHQUFhLDBDQUFBO0FBR25CLEVBQUEsTUFBTSxZQUF1QixNQUFNLFNBQUE7QUFBQSxJQUMvQix1QkFFSixDQUFBO0FBR0EsRUFBQSxNQUFNLFNBQUEsR0FBWSxJQUFBO0FBR2xCLEVBQUEsTUFBTSxTQUFBLEdBQVksZ0JBQWdCLFVBQVUsQ0FBQTtBQUM1QyxFQUFBLElBQUksY0FBYyxNQUFBLEVBQVc7QUFDekIsSUFBQSxNQUFNLElBQUksS0FBQSxDQUFNLENBQUEsNENBQUEsRUFBK0MsU0FBUyxDQUFBLHFCQUFBLENBQXVCLENBQUE7QUFBQSxFQUNuRztBQUNBLEVBQUEsTUFBTSxjQUFBLEdBQWlCLElBQUEsQ0FBSyxRQUFBLENBQVMsU0FBUyxDQUFBO0FBQzlDLEVBQUEsTUFBTSxnQkFBZ0IsSUFBQSxDQUFLLFFBQUEsQ0FBUyxJQUFBLENBQUssT0FBQSxDQUFRLFNBQVMsQ0FBQyxDQUFBO0FBQzNELEVBQUEsTUFBTSxVQUFBLEdBQWEsV0FBVyxjQUFjLENBQUEsQ0FBQTtBQUc1QyxFQUFBLE1BQU0sTUFBQSxHQUFpQztBQUFBLElBQ25DLENBQUMseUJBQXlCLEdBQUcsS0FBSyxTQUFBLENBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQTtBQUFBLElBQzNELENBQUMsS0FBSyxHQUFHLENBQUEsaUJBQUEsRUFBb0IsU0FBUyxDQUFBLEdBQUEsQ0FBQTtBQUFBLElBQ3RDLENBQUMsS0FBSyxHQUFHLENBQUEsc0JBQUEsQ0FBQTtBQUFBLElBQ1QsQ0FBQyxnQkFBZ0IsR0FBRyxNQUFBO0FBQUEsSUFDcEIsQ0FBQyxZQUFZLEdBQUc7QUFBQSxHQUNwQjtBQUlBLEVBQUEsTUFBTSxNQUFBLEdBQXNCO0FBQUEsSUFDMUI7QUFBQSxNQUNJLE1BQUEsRUFBUSxVQUFBO0FBQUEsTUFDUixNQUFBLEVBQVEsU0FBQTtBQUFBLE1BQ1IsSUFBQSxFQUFNO0FBQUE7QUFDVixHQUNGO0FBR0EsRUFBQSxJQUFJLFVBQUEsR0FBaUMsTUFBQTtBQUNyQyxFQUFBLElBQUksTUFBZ0IsRUFBQztBQUdyQixFQUFBLE1BQU0sT0FBaUIsQ0FBQyxDQUFBLFdBQUEsRUFBYyxVQUFVLENBQUEsQ0FBQSxFQUFJLGNBQUEsRUFBZ0IsYUFBYSxnQkFBZ0IsQ0FBQTtBQUdqRyxFQUFBLE1BQU0sVUFBb0IsRUFBQztBQUMzQixFQUFBLE9BQUEsQ0FBUSxJQUFBLENBQUs7QUFBQSxJQUNULFVBQUEsRUFBWSxVQUFBO0FBQUEsSUFDWixlQUFBLEVBQWlCLFVBQUE7QUFBQSxJQUNqQixpQkFBQSxFQUFtQjtBQUFBLEdBQ3RCLENBQUE7QUFFRCxFQUFBLE1BQU0saUJBQWtDLEVBQUM7QUFDekMsRUFBQSxjQUFBLENBQWUsSUFBQSxDQUFLO0FBQUEsSUFDaEIsWUFBQSxFQUFjLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUFBLElBQ3RCLEtBQUEsRUFBTztBQUFBO0FBQUEsR0FDVixDQUFBO0FBR0QsRUFBQSxNQUFNLHNCQUFBLEdBQWlEO0FBQUEsSUFDbkQsT0FBTyxTQUFBLENBQVUsRUFBQTtBQUFBLElBQ2pCLE1BQUEsRUFBUSxJQUFBO0FBQUEsSUFDUixVQUFBLEVBQVksVUFBQTtBQUFBLElBQ1osR0FBQSxFQUFLLEdBQUE7QUFBQSxJQUNMLFlBQUEsRUFBYyxFQUFFLENBQUMsQ0FBQSxFQUFHLFNBQVMsQ0FBQSxDQUFFLEdBQUcsRUFBQyxFQUFFO0FBQUEsSUFDckMsVUFBQSxFQUFZO0FBQUEsTUFDUixVQUFBLEVBQVksS0FBQTtBQUFBLE1BQ1osT0FBQSxFQUFTLE9BQUE7QUFBQSxNQUNULE1BQUEsRUFBUSxNQUFBO0FBQUEsTUFDUixjQUFBLEVBQWdCLGNBQUE7QUFBQSxNQUNoQixXQUFBLEVBQWEsQ0FBQyxlQUFlLENBQUE7QUFBQSxNQUM3QixZQUFBLEVBQWM7QUFBQSxRQUNWLFVBQUEsRUFBWTtBQUFBLFVBQ1I7QUFBQSxZQUNJLFFBQUEsRUFBVSxHQUFHLFNBQVMsQ0FBQTtBQUFBO0FBQzFCO0FBQ0o7QUFDSixLQUNKO0FBQUEsSUFFQSxXQUFBLEVBQWE7QUFBQTtBQUFBLE1BRVgsSUFBQSxFQUFNLENBQUMsV0FBQSxFQUFhLENBQUEsb0NBQUEsQ0FBc0MsQ0FBQTtBQUFBLE1BQzFELFVBQVUsTUFBQSxHQUFTLENBQUE7QUFBQSxNQUNuQixTQUFTLENBQUEsR0FBSTtBQUFBLEtBQ2I7QUFBQSxJQUNGLE1BQUEsRUFBUSxNQUFBO0FBQUEsSUFDUixHQUFBLEVBQUs7QUFBQSxHQUNUO0FBQ0EsRUFBQSxPQUFBLENBQVEsR0FBQSxDQUFJLHdCQUF3QixNQUFNLENBQUE7QUFFMUMsRUFBQSxNQUFNLEVBQUUsVUFBVSxFQUFBLEVBQUcsR0FBSSxNQUFNLGVBQUEsQ0FBZ0IsU0FBQSxDQUFVLFFBQUEsRUFBVSxzQkFBOEIsQ0FBQTtBQUlyRztBQUdBLGVBQWUsZUFBQSxDQUNYLFFBQUEsRUFDQSxzQkFBQSxFQUNBLE1BQUEsRUFDb0M7QUFFcEMsRUFBQSxPQUFBLENBQVEsSUFBSSx3QkFBd0IsQ0FBQTtBQUNwQyxFQUFBLElBQUk7QUFDQSxJQUFBLE1BQU0sTUFBQSxHQUFTLE1BQU1DLDRCQUFBLENBQWdCLGVBQUEsQ0FBZ0IsVUFBVSxzQkFBc0IsQ0FBQTtBQUVyRixJQUFBLE9BQUEsQ0FBUSxJQUFJLG9CQUFvQixDQUFBO0FBR2hDLElBQUEsT0FBTztBQUFBLE1BQ0gsSUFBSSxNQUFBLENBQU8sRUFBQTtBQUFBLE1BQ1g7QUFBQSxLQUNKO0FBQUEsRUFDSixTQUFTLEdBQUEsRUFBYztBQUNuQixJQUFBLE9BQUEsQ0FBUSxLQUFBLENBQU0sQ0FBQSw2QkFBQSxFQUFnQyxNQUFBLENBQU8sR0FBRyxDQUFDLENBQUEsQ0FBRSxDQUFBO0FBRTNELElBQUEsTUFBTSxHQUFBO0FBQUEsRUFDVjtBQUNKO0FBRUEsZUFBZSxTQUFBLENBQ1gsT0FDQSxNQUFBLEVBQ2tCO0FBRWxCLEVBQUEsT0FBQSxDQUFRLEdBQUEsQ0FBSSxDQUFBLGtCQUFBLEVBQXFCLEtBQUssQ0FBQSxJQUFBLENBQU0sQ0FBQTtBQUU1QyxFQUFBLE1BQU0sU0FBQSxHQUEyQ0Msc0JBQVMsdUJBQUEsRUFBd0I7QUFDbEYsRUFBQSxNQUFNLGNBQUEsR0FBaUIsU0FBQSxDQUNoQixNQUFBLENBQU8sQ0FBQyxFQUFFLFlBQUFDLFdBQUFBLEVBQVcsS0FBTUEsV0FBQUEsQ0FBVyxJQUFBLEtBQVMsUUFBUSxDQUFBO0FBQzlELEVBQUEsSUFBSSxDQUFDLGNBQUEsRUFBZ0IsTUFBTSxJQUFJLE1BQU0sQ0FBQSwyQkFBQSxDQUE2QixDQUFBO0FBRWxFLEVBQUEsSUFBSSxVQUFBLEdBQTBDLGNBQUEsQ0FBZSxDQUFDLENBQUEsQ0FBRSxVQUFBO0FBR2hFLEVBQUEsT0FBTyxZQUFBLENBQWEsVUFBQSxFQUFZLEtBQWdDLENBQUEsQ0FDM0QsS0FBQSxDQUFNLENBQUMsR0FBQSxLQUFpQjtBQUNyQixJQUFBLE9BQUEsQ0FBUSxNQUFNLENBQUEsbUNBQUEsRUFBc0MsS0FBSyxLQUFLLE1BQUEsQ0FBTyxHQUFHLENBQUMsQ0FBQSxDQUFFLENBQUE7QUFDM0UsSUFBQSxNQUFNLEdBQUE7QUFBQSxFQUNWLENBQUMsQ0FBQSxDQUNBLElBQUEsQ0FBSyxDQUFBLFNBQUEsS0FBYTtBQUNmLElBQUEsT0FBQSxDQUFRLElBQUksMkJBQTJCLENBQUE7QUFDdkMsSUFBQSxPQUFPLFNBQUE7QUFBQSxFQUNYLENBQUMsQ0FBQTtBQUNUO0FBRUEsZUFBZSxZQUFBLENBQ2IsVUFBQSxFQUNBLEtBQUEsRUFDQSxRQUFBLEVBQ29CO0FBQ2xCLEVBQUEsSUFBSSxTQUFBLEdBQVksTUFBQTtBQUVoQixFQUFBLElBQUk7QUFLQSxJQUFBLFNBQUEsR0FBQSxDQUNJLE1BQU1GLDZCQUFnQixVQUFBLENBQVc7QUFBQSxNQUM3QixRQUFBLEVBQVU7QUFBQSxLQUNRLENBQUEsRUFDeEIsSUFBQSxDQUFLLENBQUFHLFVBQUFBLEtBQWFBLFVBQUFBLENBQVUsUUFBQSxFQUFVLElBQUEsQ0FBSyxDQUFBLEdBQUEsS0FBTyxHQUFBLEtBQVEsS0FBSyxDQUFDLENBQUE7QUFBQSxFQUV0RSxTQUFTLEdBQUEsRUFBYztBQUNuQixJQUFBLE9BQUEsQ0FBUSxJQUFBLENBQUssMERBQTBELEdBQUcsQ0FBQTtBQUMxRSxJQUFBLE1BQU1KLHVCQUFBLENBQWEsTUFBQSxDQUFPLGdCQUFBLENBQWlCLENBQUEsd0RBQUEsRUFBMkQsR0FBRyxDQUFBLENBQUUsQ0FBQTtBQUUzRyxJQUFBLE1BQU0sR0FBQTtBQUFBLEVBQ1Y7QUFFQSxFQUFBLElBQUksY0FBYyxNQUFBLEVBQVcsTUFBTSxJQUFJLEtBQUEsQ0FBTSxDQUFBLE1BQUEsRUFBUyxLQUFLLENBQUEsV0FBQSxDQUFhLENBQUE7QUFFeEUsRUFBQSxPQUFPLFNBQUE7QUFDWDtBQUVBLGVBQXNCLFNBQVMsZ0JBQUEsRUFBZ0U7QUFVM0YsRUFBQSxJQUFJLENBQUMsRUFBQSxDQUFHLFVBQUEsQ0FBVyxnQkFBQSxDQUFpQixXQUFXLENBQUEsRUFBRTtBQUM3QyxJQUFBLEVBQUEsQ0FBRyxTQUFBLENBQVUsaUJBQWlCLFdBQVcsQ0FBQTtBQUFBLEVBQzdDO0FBRUEsRUFBQSxPQUFBLENBQVEsTUFBTSxDQUFBLHNCQUFBLENBQXdCLENBQUE7QUFDdEMsRUFBQSxxQkFBQSxDQUFzQixpQkFBaUIsV0FBVyxDQUFBO0FBR2xELEVBQUEsTUFBTSxXQUFBLEdBQWNBLHVCQUFBLENBQWEsUUFBQSxDQUFTLGVBQUEsQ0FBZ0IsdUJBQXVCLFlBQVk7QUFDekYsSUFBQSxJQUFJLENBQUNBLHVCQUFBLENBQWEsR0FBQSxDQUFJLEtBQUEsSUFBUyxLQUFBLEVBQU87QUFJdEMsSUFBQSxNQUFNLE9BQUEsR0FBVTtBQUFBLE1BQ1osMENBQUE7QUFBQSxNQUNBLHVEQUFBO0FBQUEsTUFDQTtBQUFBLEtBQXFEO0FBUXpELElBQUEsTUFBTSxNQUFBLEdBQVMsUUFBUSxDQUFDLENBQUE7QUFFeEIsSUFBQSxJQUFJO0FBQ0EsTUFBQSxJQUFJLE1BQUEsSUFBVSxPQUFBLENBQVEsQ0FBQyxDQUFBLEVBQUcsQ0FFMUIsTUFBQSxJQUFXLE1BQUEsSUFBVSxPQUFBLENBQVEsQ0FBQyxDQUFBLEVBQUcsQ0FFakMsTUFBQSxJQUFXLE1BQUEsSUFBVSxPQUFBLENBQVEsQ0FBQyxDQUFBLEVBQUc7QUFDN0IsUUFBQSxNQUFNLHlCQUFBLEVBQTBCO0FBQUEsTUFDcEM7QUFBQSxJQUNKLFNBQVMsR0FBQSxFQUFjO0FBQ25CLE1BQUEsT0FBQSxDQUFRLEtBQUEsQ0FBTSxDQUFBLGFBQUEsRUFBZ0IsTUFBQSxDQUFPLEdBQUcsQ0FBQyxDQUFBLENBQUUsQ0FBQTtBQUUzQyxNQUFBLE1BQU0sR0FBQTtBQUFBLElBQ1Y7QUFBQSxFQUNKLENBQUMsQ0FBQTtBQUlELEVBQUEsTUFBTSxPQUFPQSx1QkFBQSxDQUFhLE1BQUEsQ0FBTyxtQkFBQSxDQUFvQkEsdUJBQUEsQ0FBYSxvQkFBb0IsR0FBRyxDQUFBO0FBQ3pGLEVBQUEsSUFBQSxDQUFLLElBQUEsR0FBTyx3QkFBQTtBQUNaLEVBQUEsSUFBQSxDQUFLLE9BQUEsR0FBVSxxQkFBQTtBQUNmLEVBQUEsSUFBQSxDQUFLLElBQUEsRUFBSztBQUdWLEVBQUEsZ0JBQUEsQ0FBaUIsYUFBQSxDQUFjLEtBQUssV0FBVyxDQUFBO0FBQy9DLEVBQUEsZ0JBQUEsQ0FBaUIsYUFBQSxDQUFjLEtBQUssSUFBSSxDQUFBO0FBQzVDO0FBRUEsZUFBc0IsVUFBQSxHQUE0QjtBQUVsRDtBQUVBLGVBQXNCLHVCQUF1QixTQUFBLEVBQW1DO0FBQzVFLEVBQUEsTUFBTUEsdUJBQUEsQ0FBYSxNQUFBLENBQU8sc0JBQUEsQ0FBdUIsQ0FBQSxrREFBQSxFQUFxRCxTQUFTLENBQUEsQ0FBQSxDQUFHLENBQUE7QUFFbEgsRUFBQSxJQUFJO0FBQ0EsSUFBQSxNQUFNLEVBQUUsTUFBQSxFQUFPLEdBQUksTUFBTUEsdUJBQUEsQ0FBYSxRQUFRLElBQUEsQ0FBSyxlQUFBLEVBQWlCLENBQUMsU0FBUyxDQUFDLENBQUE7QUFDL0UsSUFBQSxNQUFNQSx1QkFBQSxDQUFhLE1BQUEsQ0FBTyxzQkFBQSxDQUF1QixDQUFBLFNBQUEsRUFBWSxNQUFNLENBQUEsQ0FBRSxDQUFBO0FBQ3JFLElBQUEsT0FBQSxDQUFRLEdBQUEsQ0FBSSxDQUFBLFNBQUEsRUFBWSxNQUFNLENBQUEsQ0FBRSxDQUFBO0FBQUEsRUFDcEMsU0FBUyxLQUFBLEVBQU87QUFDWixJQUFBLE1BQU1BLHVCQUFBLENBQWEsTUFBQSxDQUFPLHNCQUFBLENBQXVCLENBQUEsZ0NBQUEsRUFBbUMsS0FBSyxDQUFBLENBQUUsQ0FBQTtBQUMzRixJQUFBLE9BQUEsQ0FBUSxLQUFBLENBQU0sQ0FBQSwyQkFBQSxFQUE4QixLQUFBLENBQU0sT0FBTyxDQUFBLENBQUUsQ0FBQTtBQUMzRCxJQUFBLE1BQU0sSUFBSSxLQUFBLENBQU0sQ0FBQSxnQ0FBQSxFQUFtQyxLQUFLLENBQUEsQ0FBRSxDQUFBO0FBQUEsRUFDOUQ7QUFDSjs7Ozs7OzsifQ==
